[
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Genetic Data Analysis Manual",
    "section": "",
    "text": "Welcome to Genetic Data Analysis (CSES 7160) at Auburn University.\nThis course covers statistical and computational foundations for analyzing genetic, genomic, and phenotypic data in crop science, with an emphasis on reproducible workflows using R, Quarto, GitHub, and modern mixed-model approaches.\n\nKey Links\n\nSyllabus: See Shared Google Doc (or Canvas page)\nSchedule: See Shared Google Doc (or Canvas page)\nLecture Notes: See Shared Google Doc (or Canvas page)\nCourse GitHub Repo: https://github.com/wolfemd/GeneticDataAnalysisManual\n\n\n\nInstructor\nDr.¬†Marnin D. Wolfe\nAssistant Professor, Quantitative Genetics\nDepartment of Crop, Soil & Environmental Sciences, Auburn University\n\n\nLessons\n\nLesson 1 - Reproducible data projects - quarto / Markdown\nLesson 2 - Linear Models with Matrices - lm\nLesson 3 - Intro to Mixed Models - lmer\nLesson 4 - More Complex Mixed Models - asreml",
    "crumbs": [
      "Home"
    ]
  },
  {
    "objectID": "lessons/2_LinearModels.html",
    "href": "lessons/2_LinearModels.html",
    "title": "Linear Models with Matrices",
    "section": "",
    "text": "Previously: Reproducible Projects in R",
    "crumbs": [
      "Module 1",
      "Linear Models with Matrices"
    ]
  },
  {
    "objectID": "lessons/1_Quarto.html",
    "href": "lessons/1_Quarto.html",
    "title": "Reproducible Projects in R",
    "section": "",
    "text": "First steps:\n\nDownload and install R: CRAN = the Comprehensive R Archive Network\nDownload and install Rstudio: https://posit.co/download/rstudio-desktop/\n\nRstudio = an interactive development environment (IDE) or ‚Äúfront end‚Äù, R comes with it‚Äôs own, but this one is better!\n\nInstall the tidyverse: an ‚Äúopinionated collection of R packages designed for data science‚Äù\n\n\n# I'll demo multiple ways to do this, starting with\ninstall.packages(\"tidyverse\")\n\n\nIf you need a crash course in R, there are lot‚Äôs of places to start. Here are some suggestions:\n\nR for Data Science (https://r4ds.had.co.nz/):\nAs the Rstudio / Tidyverse team recommends here (https://www.tidyverse.org/learn/), this book is ‚Äúthe best place to start learning the tidyverse‚Äù. Just about anyone should be able to (1) read the brief introduction and (2) look over the table of contents and quickly find a starting point that meets their level / interest.¬†\nRStartHere (https://github.com/rstudio/RStartHere).\nThis is basically a list or compendium of functions/packages in R with the uniquely useful feature of being organized according to the ‚ÄúData Science Workflow‚Äù presented in R for Data Science (https://r4ds.had.co.nz/explore-intro.html).",
    "crumbs": [
      "Module 1",
      "Reproducible Projects in R"
    ]
  },
  {
    "objectID": "lessons/1_Quarto.html#create-a-quarto-project",
    "href": "lessons/1_Quarto.html#create-a-quarto-project",
    "title": "Reproducible Projects in R",
    "section": "Create a Quarto Project",
    "text": "Create a Quarto Project\nTo start things off, let‚Äôs everyone create a new project within which to work/learn.\n\nRstudio &gt; File &gt; New Quarto Project &gt; New Directory &gt; ‚ÄúNew Project Wizard‚Äù opens\n\nProject Wizard:\n\nSpecify a name and path to the project\nNOTICE: ‚ÄúQuarto Website‚Äù option provides",
    "crumbs": [
      "Module 1",
      "Reproducible Projects in R"
    ]
  },
  {
    "objectID": "lessons/1_Quarto.html#how-it-works",
    "href": "lessons/1_Quarto.html#how-it-works",
    "title": "Reproducible Projects in R",
    "section": "How it works",
    "text": "How it works\nLet me show you how you can use Quarto.\n\n\nOpen the .qmd file created with same name as the project\n\nWhen you‚Äôve got multiple files open, Rstudio can store this information when you close\nYou can double click the ‚Äú.Rproj‚Äù to open the project in the state you left it!\n\n\n\nYAML\n\nThe file starts with a yaml ‚Äúheader‚Äù between two ‚Äú‚Äî‚Äù\n\nDefines format, behavior, rendered appearance\nAlso defines things like:\n\ntitle\nauthor\nformat\neditor\n\n\nThere is also a project-wide yaml file _quarto.yml.\n\nYou can control overall format and behavior with it.\nIt‚Äôs also where you can build out a Navigation bar if you have multiple linked pages in your project.\n\n\n\n---\nproject:\n  title: \"linear_models_intro\"\n\neditor: visual\n\nformat:\n  html:\n    toc: true\n    embed-resources: true\n    self-contained-math: true\n---\n\n\n\nMarkdown\nFor the authoritative documentation: https://quarto.org/docs/authoring/markdown-basics.html\n\nFormatting text\n\nHeadings using (e.g.¬†#, ##, ###)\n\nDifferent from ‚ÄúCOMMENTING‚Äù out code lines\n\nBolds (with **) and italics (*).\nLaTeX math\n\n\n\n\nLaTeX math\n\nInline with ($)\nFull display on own line with ($$)\n\nA superscript with (^), and underscore with (_)\nExample \\sigma^2_e renders as \\(\\sigma^2_e\\)\nYou can do more complicated super/subscripts, like so:\nx_{a^{b-c}} becomes\n\\[x_{a^{b-c}}\\]\nWhile \\frac{cov(x,y)}{var(x)} = \\hat{\\beta} renders as\n\\[\n\\frac{cov(x,y)}{var(x)} = \\hat{\\beta}\n\\]\nAnd much more.\nThere are plug-ins for Word and Google Docs that can read/render LaTeX equations.\n\n\nCode chunks\nIn your .qmd file, type Cmd + Option + I (Mac) or Ctrl + Alt + I (Win).\nShould create a ‚Äúcode chunk‚Äù, like this:\n```{r}\n# code here\n```\n\nNote the ‚ÄúPlay‚Äù and other config. buttons\n\n\n\nRendering\n\nSave and press the ‚ÄúRender‚Äù button\n\nNOTE on Rendering Quarto Markdown: Rendering runs all code chunks. If you have a long-running, resource intensive project, structure it to avoid running that part during render. Use ‚Äú````{r, eval=FALSE}`‚Äù.",
    "crumbs": [
      "Module 1",
      "Reproducible Projects in R"
    ]
  },
  {
    "objectID": "lessons/1_Quarto.html#visual-vs.-source-editor",
    "href": "lessons/1_Quarto.html#visual-vs.-source-editor",
    "title": "Reproducible Projects in R",
    "section": "Visual vs.¬†Source Editor",
    "text": "Visual vs.¬†Source Editor\n\nAt the top left. Two options.\nOther navigation pro-tips\n\nThe ‚ÄúOutline‚Äù tab in the Editor (top right)\n\nCode folding",
    "crumbs": [
      "Module 1",
      "Reproducible Projects in R"
    ]
  },
  {
    "objectID": "lessons/1_Quarto.html#objects-and-data-structures",
    "href": "lessons/1_Quarto.html#objects-and-data-structures",
    "title": "Reproducible Projects in R",
    "section": "Objects and data structures",
    "text": "Objects and data structures\n\n\n\n\n\n\nFigure¬†1: R Data structures ‚Äì figure from https://www.dataquest.io/\n\n\n\n\nVectors\n\n# Atomic vectors\nx = c(1,2,3,4,5,6) # numerical vector\nx1 = c(1.2, 1.3,1.8, 2.9, 10.5,0.9) # numerical vectors\ny &lt;- c(\"A\", \"B\", \"A\") # character vector\nz = c(TRUE, TRUE, FALSE, FALSE) # logical vector\n\ndim(x)\n\nNULL\n\nas.matrix(x)\n\n     [,1]\n[1,]    1\n[2,]    2\n[3,]    3\n[4,]    4\n[5,]    5\n[6,]    6\n\ndim(as.matrix(x))\n\n[1] 6 1\n\n\nVectors may only have one type.\n\n\nMatrices\n\n# Matrix: vectors in more than one dimension \nX &lt;- matrix(c(1, 0,\n              1, 1,\n              1, 0), nrow = 3, byrow = TRUE)\n\nX\n\n     [,1] [,2]\n[1,]    1    0\n[2,]    1    1\n[3,]    1    0\n\ndim(X)\n\n[1] 3 2\n\n\nMatrices can also only have one type or the other (char, num, logi).\n\n\ndata.frames\n\ndf &lt;- data.frame(y = c(10, 12, 11),\n                 geno = factor(c(\"G1\", \"G2\", \"G1\")),\n                 block = factor(c(1, 1, 2)))\nstr(df)\n\n'data.frame':   3 obs. of  3 variables:\n $ y    : num  10 12 11\n $ geno : Factor w/ 2 levels \"G1\",\"G2\": 1 2 1\n $ block: Factor w/ 2 levels \"1\",\"2\": 1 1 2\n\n\n\nColumns = variables\nRows = observations\nmixed variable types\nTechnically, a special case of a list\n\n\n# Example in Genomics\nx = c(\"snp1\",\"snp2\", \"snp3\", \"snp4\", \"snp5\", \"snp6\")\ny = c(1,1,2,2,3,3)\nz = c(10,20,100,400,150,200)\nind1 = c(\"AA\", \"AA\", \"aa\", \"Aa\", \"aa\", \"AA\")\nind2 = c(\"AA\", \"AA\", \"aa\", \"Aa\", \"AA\", \"AA\")\nind3 = c(\"Aa\", \"AA\", \"aa\", \"Aa\", \"Aa\", \"aa\")\nind4 = c(\"aa\", \"AA\", \"Aa\", \"aa\", \"AA\", \"AA\")\n\nsnp_data = data.frame(name = x,chr = y,pos = z,ind1,ind2,ind3,ind4)\nsnp_data\n\n  name chr pos ind1 ind2 ind3 ind4\n1 snp1   1  10   AA   AA   Aa   aa\n2 snp2   1  20   AA   AA   AA   AA\n3 snp3   2 100   aa   aa   aa   Aa\n4 snp4   2 400   Aa   Aa   Aa   aa\n5 snp5   3 150   aa   AA   Aa   AA\n6 snp6   3 200   AA   AA   aa   AA\n\n\n\n\nFactors\n\nlevels(df$geno)\n\n[1] \"G1\" \"G2\"\n\n\nFactors add a layer of information (an attribute) called levels().\nUse them ONLY for specific purposes to avoid undesired behavior.\nTwo examples (demo later):\n\nFactor levels matter for design matrix creation. They control the ordering of columns in a model.matrix() call.\nFactor levels control the order of appearance of categories in a plot made with ggplot(). ### Lists\n\nContainers for anything. Mix any type.\n\nm &lt;- lm(y ~ geno + block, data = df)\nstr(m)\n\nList of 13\n $ coefficients : Named num [1:3] 10 2 1\n  ..- attr(*, \"names\")= chr [1:3] \"(Intercept)\" \"genoG2\" \"block2\"\n $ residuals    : Named num [1:3] 0 0 0\n  ..- attr(*, \"names\")= chr [1:3] \"1\" \"2\" \"3\"\n $ effects      : Named num [1:3] -19.053 -1.225 0.707\n  ..- attr(*, \"names\")= chr [1:3] \"(Intercept)\" \"genoG2\" \"block2\"\n $ rank         : int 3\n $ fitted.values: Named num [1:3] 10 12 11\n  ..- attr(*, \"names\")= chr [1:3] \"1\" \"2\" \"3\"\n $ assign       : int [1:3] 0 1 2\n $ qr           :List of 5\n  ..$ qr   : num [1:3, 1:3] -1.732 0.577 0.577 -0.577 -0.816 ...\n  .. ..- attr(*, \"dimnames\")=List of 2\n  .. .. ..$ : chr [1:3] \"1\" \"2\" \"3\"\n  .. .. ..$ : chr [1:3] \"(Intercept)\" \"genoG2\" \"block2\"\n  .. ..- attr(*, \"assign\")= int [1:3] 0 1 2\n  .. ..- attr(*, \"contrasts\")=List of 2\n  .. .. ..$ geno : chr \"contr.treatment\"\n  .. .. ..$ block: chr \"contr.treatment\"\n  ..$ qraux: num [1:3] 1.577 1.966 0.707\n  ..$ pivot: int [1:3] 1 2 3\n  ..$ tol  : num 1e-07\n  ..$ rank : int 3\n  ..- attr(*, \"class\")= chr \"qr\"\n $ df.residual  : int 0\n $ contrasts    :List of 2\n  ..$ geno : chr \"contr.treatment\"\n  ..$ block: chr \"contr.treatment\"\n $ xlevels      :List of 2\n  ..$ geno : chr [1:2] \"G1\" \"G2\"\n  ..$ block: chr [1:2] \"1\" \"2\"\n $ call         : language lm(formula = y ~ geno + block, data = df)\n $ terms        :Classes 'terms', 'formula'  language y ~ geno + block\n  .. ..- attr(*, \"variables\")= language list(y, geno, block)\n  .. ..- attr(*, \"factors\")= int [1:3, 1:2] 0 1 0 0 0 1\n  .. .. ..- attr(*, \"dimnames\")=List of 2\n  .. .. .. ..$ : chr [1:3] \"y\" \"geno\" \"block\"\n  .. .. .. ..$ : chr [1:2] \"geno\" \"block\"\n  .. ..- attr(*, \"term.labels\")= chr [1:2] \"geno\" \"block\"\n  .. ..- attr(*, \"order\")= int [1:2] 1 1\n  .. ..- attr(*, \"intercept\")= int 1\n  .. ..- attr(*, \"response\")= int 1\n  .. ..- attr(*, \".Environment\")=&lt;environment: R_GlobalEnv&gt; \n  .. ..- attr(*, \"predvars\")= language list(y, geno, block)\n  .. ..- attr(*, \"dataClasses\")= Named chr [1:3] \"numeric\" \"factor\" \"factor\"\n  .. .. ..- attr(*, \"names\")= chr [1:3] \"y\" \"geno\" \"block\"\n $ model        :'data.frame':  3 obs. of  3 variables:\n  ..$ y    : num [1:3] 10 12 11\n  ..$ geno : Factor w/ 2 levels \"G1\",\"G2\": 1 2 1\n  ..$ block: Factor w/ 2 levels \"1\",\"2\": 1 1 2\n  ..- attr(*, \"terms\")=Classes 'terms', 'formula'  language y ~ geno + block\n  .. .. ..- attr(*, \"variables\")= language list(y, geno, block)\n  .. .. ..- attr(*, \"factors\")= int [1:3, 1:2] 0 1 0 0 0 1\n  .. .. .. ..- attr(*, \"dimnames\")=List of 2\n  .. .. .. .. ..$ : chr [1:3] \"y\" \"geno\" \"block\"\n  .. .. .. .. ..$ : chr [1:2] \"geno\" \"block\"\n  .. .. ..- attr(*, \"term.labels\")= chr [1:2] \"geno\" \"block\"\n  .. .. ..- attr(*, \"order\")= int [1:2] 1 1\n  .. .. ..- attr(*, \"intercept\")= int 1\n  .. .. ..- attr(*, \"response\")= int 1\n  .. .. ..- attr(*, \".Environment\")=&lt;environment: R_GlobalEnv&gt; \n  .. .. ..- attr(*, \"predvars\")= language list(y, geno, block)\n  .. .. ..- attr(*, \"dataClasses\")= Named chr [1:3] \"numeric\" \"factor\" \"factor\"\n  .. .. .. ..- attr(*, \"names\")= chr [1:3] \"y\" \"geno\" \"block\"\n - attr(*, \"class\")= chr \"lm\"",
    "crumbs": [
      "Module 1",
      "Reproducible Projects in R"
    ]
  },
  {
    "objectID": "lessons/1_Quarto.html#base-r",
    "href": "lessons/1_Quarto.html#base-r",
    "title": "Reproducible Projects in R",
    "section": "Base R",
    "text": "Base R\nVectors\n\ny[1]\n\n[1] 1\n\nz[2:3]\n\n[1]  20 100\n\nz[-c(1:5)]\n\n[1] 200\n\n\nMatrices\nmatrix[row,column]\n\nX[1:2,]\n\n     [,1] [,2]\n[1,]    1    0\n[2,]    1    1\n\n\ndata.frames\n\ndf[1,2]\n\n[1] G1\nLevels: G1 G2\n\ndf$geno\n\n[1] G1 G2 G1\nLevels: G1 G2\n\ndf[[\"geno\"]]\n\n[1] G1 G2 G1\nLevels: G1 G2\n\ndf[[\"geno\"]][1]\n\n[1] G1\nLevels: G1 G2\n\n\nLists\n\nm$coefficients\n\n(Intercept)      genoG2      block2 \n         10           2           1 \n\nm[1:2]\n\n$coefficients\n(Intercept)      genoG2      block2 \n         10           2           1 \n\n$residuals\n1 2 3 \n0 0 0 \n\nm[1:2][[\"residuals\"]]\n\n1 2 3 \n0 0 0 \n\nm[1:2][[\"residuals\"]][1]\n\n1 \n0",
    "crumbs": [
      "Module 1",
      "Reproducible Projects in R"
    ]
  },
  {
    "objectID": "lessons/1_Quarto.html#tidyverse-style---dplyr",
    "href": "lessons/1_Quarto.html#tidyverse-style---dplyr",
    "title": "Reproducible Projects in R",
    "section": "tidyverse style - dplyr + %>%",
    "text": "tidyverse style - dplyr + %&gt;%\nLet‚Äôs add to the tool set.\nThe ‚Äútidyverse‚Äù series of package provides a huge amount of utility for clear, human-readable programming. You‚Äôll learn it well following ‚ÄúR for Data Science‚Äù.\n\nlibrary(tidyverse)\n\nWarning: package 'ggplot2' was built under R version 4.5.2\n\n\nWarning: package 'tibble' was built under R version 4.5.2\n\n\nWarning: package 'tidyr' was built under R version 4.5.2\n\n\nWarning: package 'readr' was built under R version 4.5.2\n\n\nWarning: package 'purrr' was built under R version 4.5.2\n\n\nFirst magrittr‚Äôs ‚Äúpipe‚Äù function (%&gt;%).\n\n\n\nx %&gt;% f is equivalent to f(x)\nx %&gt;% f(y) is equivalent to f(x, y)\nx %&gt;% f %&gt;% g %&gt;% h is equivalent to h(g(f(x)))\n\nThe left-hand side is evaluated first, then passed as input to the right-hand side.\nAn argument placeholder exists to direct the input from left into the right side function. - x %&gt;% f(y, .) is equivalent to f(y, x) - x %&gt;% f(y, z = .) is equivalent to f(y, z = x)\nKeyboard Shortcut: Type CMD + Shift + M (Mac) or CTRL + Shift + M (Win) to make pipes (%&gt;%) easily\n\nsum(snp_data$chr)\n\n[1] 12\n\n# is equivalent to\nsnp_data$chr %&gt;% sum(.)\n\n[1] 12\n\n# or\nsnp_data$chr %&gt;% sum # for shortest\n\n[1] 12\n\n\nNow let‚Äôs add dplyr (https://dplyr.tidyverse.org/) ‚Äúa grammar of data manipulation‚Äù.\n\nCheatsheet: https://biostats.w.uib.no/dplyr-a-simplified-cheat-sheet/\nmutate() adds new variables that are functions of existing variables\nselect() picks variables based on their names.\nfilter() picks cases based on their values.\nsummarise() reduces multiple values down to a single summary.\narrange() changes the ordering of the rows.\n\nLet‚Äôs use just filter() and select() now.\n\n# Filter for subsetting the rows of a data.frame\nsnp_data %&gt;% \n  filter(chr==1,\n         pos&lt;100)\n# Select to subset the columns and/or reorder them\nsnp_data %&gt;% \n  select(chr,pos,ind2:ind3)\n\n# Combo \nsnp_data %&gt;% \n  # pick out chromosome 2 only\n  filter(chr==2) %&gt;% \n  # select desired colulmns\n  select(chr,pos) %&gt;% \n  # grab a single column\n  .$pos %&gt;% \n  # pass it to a function like summary\n  summary",
    "crumbs": [
      "Module 1",
      "Reproducible Projects in R"
    ]
  },
  {
    "objectID": "lessons/1_Quarto.html#addsubtractarithmetic",
    "href": "lessons/1_Quarto.html#addsubtractarithmetic",
    "title": "Reproducible Projects in R",
    "section": "Add/Subtract/Arithmetic",
    "text": "Add/Subtract/Arithmetic\n\n\n\n\n\n\nFigure¬†2: Element-wise operations ‚Äì figure from https://www.dataquest.io/\n\n\n\n\n4+4 # sum\n3/3 # divide\nlog(10) # natural logarithm\nlog10(0.01) # base-10 logarithm\nexp(2.3) # exponential\n\n# Summary statistics\ntmp = c(1,2,3) # example\nmean(tmp) # mean\nvar(tmp) # variance\nsum(tmp) # sum\n\n# Summary statistic in data frame\nmean(snp_data$pos) # mean of a col in the data frame\nvar(snp_data$pos) # var of a col in the data frame\n\n# Example from https://www.dataquest.io/\nexam_grades &lt;- c(92, 90, 84, 95, 77, 92, 85)\nhomework_grades &lt;- c(87, 81, 95, 86, 85, 90, 88)\nsum_grades = exam_grades+ homework_grades\n\nRecall:\n\\[\ny = X\\beta + \\epsilon\n\\]",
    "crumbs": [
      "Module 1",
      "Reproducible Projects in R"
    ]
  },
  {
    "objectID": "lessons/1_Quarto.html#matrix-multiplication",
    "href": "lessons/1_Quarto.html#matrix-multiplication",
    "title": "Reproducible Projects in R",
    "section": "Matrix multiplication",
    "text": "Matrix multiplication\n\nbeta &lt;- c(10, 2)\n\n# Matrix multiplication\nX %*% beta\n\n     [,1]\n[1,]   10\n[2,]   12\n[3,]   10\n\nbeta * beta\n\n[1] 100   4\n\nbeta %*% beta\n\n     [,1]\n[1,]  104\n\n\nCross products and transpose\n\nt(X) %*% X\n\n     [,1] [,2]\n[1,]    3    1\n[2,]    1    1\n\nt(X) %*% c(10, 12, 11)\n\n     [,1]\n[1,]   33\n[2,]   12\n\n\nInversion\nRecall that \\(A^{-1}A=AA^{-1}=1\\) defines an inverse matrix\n\nA&lt;-t(X) %*% X # make a square matrix\nA\n\n     [,1] [,2]\n[1,]    3    1\n[2,]    1    1\n\n\n\n# Invert it\nAinv&lt;-solve(A)\nAinv\n\n     [,1] [,2]\n[1,]  0.5 -0.5\n[2,] -0.5  1.5\n\n\n\nA%*%Ainv\n\n             [,1] [,2]\n[1,] 1.000000e+00    0\n[2,] 5.551115e-17    1\n\n\nRecall the OLS solution for a linear model:\n\\[\n\\hat{\\beta} = (X^TX)^{-1}X^Ty\n\\]\n\ny &lt;- c(10, 12, 11)\nsolve(t(X) %*% X) %*% t(X) %*% y\n\n     [,1]\n[1,] 10.5\n[2,]  1.5",
    "crumbs": [
      "Module 1",
      "Reproducible Projects in R"
    ]
  },
  {
    "objectID": "lessons/about.html",
    "href": "lessons/about.html",
    "title": "About",
    "section": "",
    "text": "About this site\n\n1 + 1\n\n[1] 2"
  },
  {
    "objectID": "lessons/2_LinearModels.html#toy-model",
    "href": "lessons/2_LinearModels.html#toy-model",
    "title": "Linear Models with Matrices",
    "section": "Toy model¬†",
    "text": "Toy model",
    "crumbs": [
      "Module 1",
      "Linear Models with Matrices"
    ]
  },
  {
    "objectID": "lessons/2_LinearModels.html#real-data-model",
    "href": "lessons/2_LinearModels.html#real-data-model",
    "title": "Linear Models with Matrices",
    "section": "Real data model",
    "text": "Real data model",
    "crumbs": [
      "Module 1",
      "Linear Models with Matrices"
    ]
  },
  {
    "objectID": "lessons/2_LinearModels.html#exploratory-data-analysis",
    "href": "lessons/2_LinearModels.html#exploratory-data-analysis",
    "title": "Linear Models with Matrices",
    "section": "Exploratory data analysis",
    "text": "Exploratory data analysis\n\nLater, we‚Äôll take some time. Practice using R, especially dplyr and related tidyverse functions to summarize and get to know the dataset.\n\n\nTransforming data\npivot_wider() pivot_longer() group_by() + nest()\n\n\nAnalyzing multiple traits\npurrr()\nFunctions?\n\n\nSummary statistics\n\n\nTrait distributions",
    "crumbs": [
      "Module 1",
      "Linear Models with Matrices"
    ]
  },
  {
    "objectID": "lessons/2_LinearModels.html#anova",
    "href": "lessons/2_LinearModels.html#anova",
    "title": "Linear Models with Matrices",
    "section": "ANOVA",
    "text": "ANOVA\nTwo parts of Analysis of Variance\n\nCompute means\nCompute deviations (sums of squares, mean squares)\n\n\n\n\n\n\n\nFigure¬†2: Computing means and sums of squares for ANOVA\n\n\n\nAnd we can write the classical ANOVA table. Variance is partitioned into two components: Among Groups and Within Groups.\n\n\n\n\n\n\n\n\n\n\nSource of Variation\nDegrees of Freedom (DF)\nSum of Squares (SS)\nMean Square (MS)\nF-value\n\n\n\n\nAmong Groups\n\\(\\alpha‚àí1\\)\n\\(SS_A=\\sum_{i=1}^{\\alpha} n_i ( \\bar{y_i.} - \\bar{y..})^2\\)\n$\n\n\n\n\nMS_A = $ | ùêπ=\\frac{MS_A}{MS_E} | | Within Groups | \\(ùëÅ‚àí\\alpha\\) | $ SS_E = {i=1}^{j=1}^{n_i} (y_{ij} - {y_i.})^2 $ | $ MS_E = \\frac{SS_E}{N- $ | | | Total | \\(ùëÅ‚àí1\\) | $ SS_T = {i=1}^{j=1}^{n_i} (y_{ij} - {y_{..}})^2 $ | | |\nQuestion:",
    "crumbs": [
      "Module 1",
      "Linear Models with Matrices"
    ]
  },
  {
    "objectID": "lessons/2_LinearModels.html#anova-with-lm",
    "href": "lessons/2_LinearModels.html#anova-with-lm",
    "title": "Linear Models with Matrices",
    "section": "ANOVA with lm()",
    "text": "ANOVA with lm()\nTwo parts of Analysis of Variance\n\nCompute means\nCompute deviations (sums of squares, mean squares)\n\n\n\n\n\n\n\nFigure¬†2: Computing means and sums of squares for ANOVA\n\n\n\nAnd we can write the classical ANOVA table. Variance is partitioned into two components: Among Groups and Within Groups.\n\n\n\n\n\n\n\n\n\n\nSource of Variation\nDegrees of Freedom (DF)\nSum of Squares (SS)\nMean Square (MS)\nF-value\n\n\n\n\nAmong Groups\n\\(\\alpha‚àí1\\)\n\\(SS_A=\\sum_{i=1}^{\\alpha} n_i ( \\bar{y_i\\cdot} - \\bar{y\\cdot\\cdot})^2\\)\n\\(MS_A = \\frac{SS_A}{\\alpha-1}\\)\n\\(ùêπ=\\frac{MS_A}{MS_E}\\)\n\n\nWithin Groups\n\\(ùëÅ‚àí\\alpha\\)\n\\(SS_E = \\sum_{i=1}^\\alpha \\sum_{j=1}^{n_i} (y_{ij} - \\bar{y_i\\cdot})^2\\)\n\\(MS_E = \\frac{SS_E}{N-\\alpha}\\)\n\n\n\nTotal\n\\(ùëÅ‚àí1\\)\n\\(SS_T = \\sum_{i=1}^\\alpha \\sum_{j=1}^{n_i} (y_{ij} - \\bar{y_{\\cdot\\cdot}})^2\\)\n\n\n\n\n\nWhere:\n\n\\(\\alpha\\) = number of groups\n\\(n\\) = number of observations in group ùëñ\n\\(N\\) = total number of observations\n\\(\\bar{y_{i\\cdot}}\\) = mean of group ùëñ\n\\(\\bar{y_{\\cdot\\cdot}}\\) = grand mean\n\nOur goal is to partition tot. variance into sources.\nWe compare the variance among groups (e.g.¬†among genotypes) to the residual variance using a ratio of variances (the F-value).\nBasically, the F-test is looking for greater signal compared to noise. A high F-value means among groups &gt; residual and so group variance is probably important.\n\nlibrary(tidyverse)\n\n\n# Create an example\ndf &lt;- data.frame(Replicate = 1:4,\n                 GenoA = c(14, 17, 15, 15),\n                 GenoB = c(11, 13, 10, 12)) \ndf &lt;- df %&gt;% \n  # this will change the \"wide\" data frame to a \"long\" one\n  ## it stacks the values of GenoA and GenoB into a column labelled \"Biomass\"\n  ## and the col headers go to a new column \"Genotype\"\n  pivot_longer(cols = c(GenoA, GenoB),\n               names_to = \"Genotype\",\n               values_to = \"Biomass\") %&gt;% \n  # Make genotype and replicate into factors\n    mutate(Genotype=as.factor(Genotype),\n           # Replicate needs to be a factor-type\n           # because it should be treated as a categorical NOT a numerical variable\n           ### Replicate 4 doesn't come after Replicate 3 in any logical way.\n           Replicate=as.factor(Replicate))\n\n\nfit.lm &lt;- lm(Biomass ~ Genotype, data = df)\nsummary(fit.lm)\n\n\nCall:\nlm(formula = Biomass ~ Genotype, data = df)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-1.5000 -0.6875 -0.2500  0.7500  1.7500 \n\nCoefficients:\n              Estimate Std. Error t value Pr(&gt;|t|)    \n(Intercept)    15.2500     0.6374   23.93  3.5e-07 ***\nGenotypeGenoB  -3.7500     0.9014   -4.16  0.00594 ** \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 1.275 on 6 degrees of freedom\nMultiple R-squared:  0.7426,    Adjusted R-squared:  0.6997 \nF-statistic: 17.31 on 1 and 6 DF,  p-value: 0.005943\n\n\n\nfit.aov&lt;-aov(Biomass ~ Genotype, data = df)\nsummary(fit.aov)\n\n            Df Sum Sq Mean Sq F value  Pr(&gt;F)   \nGenotype     1  28.12  28.125   17.31 0.00594 **\nResiduals    6   9.75   1.625                   \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n\n\nt.test(Biomass~Genotype,data = df)\n\n\n    Welch Two Sample t-test\n\ndata:  Biomass by Genotype\nt = 4.1603, df = 5.9961, p-value = 0.005951\nalternative hypothesis: true difference in means between group GenoA and group GenoB is not equal to 0\n95 percent confidence interval:\n 1.544032 5.955968\nsample estimates:\nmean in group GenoA mean in group GenoB \n              15.25               11.50 \n\n\nNotice the way the coefficients are reported from lm().\nIt shows only an effect for (Intercept) and GenotypeGenoB.\nInitially, we wrote the model as\n\\[\ny_{ij} = \\mu + \\tau_i + \\epsilon_{ij}\n\\]\n\\(i\\) genotypes (1,2), \\(j\\) replications (1,2,3,4)\nSo our matrices and vectors looked like this:\n\\[\n\\begin{bmatrix}\ny_{11} \\\\\ny_{12} \\\\\ny_{13} \\\\\ny_{14} \\\\\ny_{21} \\\\\ny_{22} \\\\\ny_{23} \\\\\ny_{24}\n\\end{bmatrix} =\n\\begin{bmatrix}\n1 & 0 & 0 \\\\\n1 & 1 & 0 \\\\\n1 & 1 & 0 \\\\\n1 & 1 & 0 \\\\\n1 & 0 & 1 \\\\\n1 & 0 & 1 \\\\\n1 & 0 & 1 \\\\\n1 & 0 & 1\n\\end{bmatrix}\n\\begin{bmatrix}\n\\mu \\\\\n\\tau_1 \\\\\n\\tau_2\n\\end{bmatrix} +\n\\begin{bmatrix}\n\\epsilon_{11} \\\\\n\\epsilon_{12} \\\\\n\\epsilon_{13} \\\\\n\\epsilon_{14} \\\\\n\\epsilon_{21} \\\\\n\\epsilon_{22} \\\\\n\\epsilon_{23} \\\\\n\\epsilon_{24}\n\\end{bmatrix}\n\\]\nThis specification implies 3 coefficients would be estimated (\\(\\mu\\), \\(\\tau_1\\) and \\(\\tau_2\\)).",
    "crumbs": [
      "Module 1",
      "Linear Models with Matrices"
    ]
  },
  {
    "objectID": "lessons/2_LinearModels.html#parameter-estimation-with-ols",
    "href": "lessons/2_LinearModels.html#parameter-estimation-with-ols",
    "title": "Linear Models with Matrices",
    "section": "Parameter estimation with OLS",
    "text": "Parameter estimation with OLS\nTo see why the difference, let‚Äôs first calculate the OLS solution ‚Äúby hand‚Äù\nRecall from class that linear models with fixed-effects and simple residuals can be solved with a closed form approach that minimizes the residual sum of squares (RSS). This is called the ‚ÄúOrdinary Least Squares‚Äù solution (OLS).\n\\[\n\\hat{\\beta} = (X'X)^{-1}X'y\n\\]\n\ndf\n\n# A tibble: 8 √ó 3\n  Replicate Genotype Biomass\n  &lt;fct&gt;     &lt;fct&gt;      &lt;dbl&gt;\n1 1         GenoA         14\n2 1         GenoB         11\n3 2         GenoA         17\n4 2         GenoB         13\n5 3         GenoA         15\n6 3         GenoB         10\n7 4         GenoA         15\n8 4         GenoB         12\n\n\n\ny&lt;-df$Biomass\n\n# Because R is too smart, we'll have to make the X matrix shown above for a demo\n\nX&lt;-matrix(c(1,1,1,1,1,1,1,1,\n            1,0,1,0,1,0,1,0,\n            0,1,0,1,0,1,0,1),\n          ncol=3)\nX\n\n     [,1] [,2] [,3]\n[1,]    1    1    0\n[2,]    1    0    1\n[3,]    1    1    0\n[4,]    1    0    1\n[5,]    1    1    0\n[6,]    1    0    1\n[7,]    1    1    0\n[8,]    1    0    1\n\n\nR provides a function called model.matrix() for constructing design matrices. What model.matrix() does, is what lm() and other software do.\n\nX1&lt;-model.matrix(Biomass~Genotype,data = df)\nX1\n\n  (Intercept) GenotypeGenoB\n1           1             0\n2           1             1\n3           1             0\n4           1             1\n5           1             0\n6           1             1\n7           1             0\n8           1             1\nattr(,\"assign\")\n[1] 0 1\nattr(,\"contrasts\")\nattr(,\"contrasts\")$Genotype\n[1] \"contr.treatment\"\n\n\n\nXtX&lt;-t(X)%*%X\nXty&lt;-t(X)%*%y\nbeta_hat&lt;-solve(XtX)%*%Xty\n\nError in `solve.default()`:\n! Lapack routine dgesv: system is exactly singular: U[3,3] = 0\n\n\nSingular = a square matrix that is not invertible\nA related term is ‚ÄúRank‚Äù which refers to the number of linearly independent columns of a matrix.\n\n# What is the \"rank\" of XtX? Want it to be 3.\nqr(XtX)$rank\n\n[1] 2\n\n\nThe XtX matrix is not ‚Äúfull rank‚Äù because columns 2 and 3 are numerical mirrors.\nThere aren‚Äôt enough degrees of freedom to express it this way.\nIn R, functions like lm() will automatically constrain the model by contrasting levels against a reference (the first level of the factor).\nSo \\(\\tau_1 = 0\\) and \\(\\tau_2=1\\).\n\\[\n\\begin{bmatrix}\ny_{11} \\\\\ny_{12} \\\\\ny_{13} \\\\\ny_{14} \\\\\ny_{21} \\\\\ny_{22} \\\\\ny_{23} \\\\\ny_{24}\n\\end{bmatrix} =\n\\begin{bmatrix}\n1 & 0 \\\\\n1 & 0 \\\\\n1 & 0 \\\\\n1 & 0 \\\\\n1 & 1 \\\\\n1 & 1 \\\\\n1 & 1 \\\\\n1 & 1\n\\end{bmatrix}\n\\begin{bmatrix}\n\\mu \\\\\n\\tau_2\n\\end{bmatrix} +\n\\begin{bmatrix}\n\\epsilon_{11} \\\\\n\\epsilon_{12} \\\\\n\\epsilon_{13} \\\\\n\\epsilon_{14} \\\\\n\\epsilon_{21} \\\\\n\\epsilon_{22} \\\\\n\\epsilon_{23} \\\\\n\\epsilon_{24}\n\\end{bmatrix}\n\\]\n\nbeta_hat&lt;-solve(t(X1)%*%X1)%*%(t(X1)%*%y)\nbeta_hat\n\n               [,1]\n(Intercept)   15.25\nGenotypeGenoB -3.75\n\n\n\nfit.lm$coefficients\n\n  (Intercept) GenotypeGenoB \n        15.25         -3.75 \n\n\nTa da! üéâ",
    "crumbs": [
      "Module 1",
      "Linear Models with Matrices"
    ]
  },
  {
    "objectID": "lessons/2_LinearModels.html#check-assumptions",
    "href": "lessons/2_LinearModels.html#check-assumptions",
    "title": "Linear Models with Matrices",
    "section": "Check assumptions",
    "text": "Check assumptions\n\nhist(residuals(fit.lm))\nplot(x = fitted(fit.lm), y = residuals(fit.lm))\nplot(fit.lm)",
    "crumbs": [
      "Module 1",
      "Linear Models with Matrices"
    ]
  },
  {
    "objectID": "lessons/2_LinearModels.html#estimated-marginal-means",
    "href": "lessons/2_LinearModels.html#estimated-marginal-means",
    "title": "Linear Models with Matrices",
    "section": "Estimated marginal means",
    "text": "Estimated marginal means\nOur goal is often to compare the mean of different treatment groups, for example different genotypes.\nYou may have encountered ‚Äúlsmeans‚Äù or ‚Äúemmeans‚Äù in the literature? Or if you use SAS.\nLeast squares means (LSMeans)‚Äînow more commonly called estimated marginal means (EMMs)‚Äîare model-based estimates of factor level means derived from a fitted linear model (LM). They are related to the ‚Äúbest linear unbiased estimators‚Äù (BLUEs) in a linear mixed model; we‚Äôll get to all that later.\n\nlibrary(emmeans)\n\nWarning: package 'emmeans' was built under R version 4.5.2\n\n\nWelcome to emmeans.\nCaution: You lose important information if you filter this package's results.\nSee '? untidy'\n\nemmeans(fit.lm,\"Genotype\")\n\n Genotype emmean    SE df lower.CL upper.CL\n GenoA      15.2 0.637  6    13.69     16.8\n GenoB      11.5 0.637  6     9.94     13.1\n\nConfidence level used: 0.95 \n\n\nEMMs are not arithmetic means. They are predicted means from the fitted model. If there were additional factors in our model, they would evaluate our ‚ÄúGenotypes‚Äù averaging over the other factors/covariates.\nLook at how they are related to the coefficients from the OLS model.\n\nsummary(fit.lm)\n\n\nCall:\nlm(formula = Biomass ~ Genotype, data = df)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-1.5000 -0.6875 -0.2500  0.7500  1.7500 \n\nCoefficients:\n              Estimate Std. Error t value Pr(&gt;|t|)    \n(Intercept)    15.2500     0.6374   23.93  3.5e-07 ***\nGenotypeGenoB  -3.7500     0.9014   -4.16  0.00594 ** \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 1.275 on 6 degrees of freedom\nMultiple R-squared:  0.7426,    Adjusted R-squared:  0.6997 \nF-statistic: 17.31 on 1 and 6 DF,  p-value: 0.005943",
    "crumbs": [
      "Module 1",
      "Linear Models with Matrices"
    ]
  },
  {
    "objectID": "lessons/2_LinearModels.html#some-real-data",
    "href": "lessons/2_LinearModels.html#some-real-data",
    "title": "Linear Models with Matrices",
    "section": "Some real data",
    "text": "Some real data\nDownload the CCB Crimson Clover ALT dataset from Canvas.\nPut it in the data/ sub-directory of your project.\n\nlibrary(tidyverse)\n\nImport the dataset\n\nalt&lt;-read.csv(here::here(\"data\",\"19-25CC_ALT_DATA_ALL_2025-08-23.csv\"))\n\nstr(alt)\n\n'data.frame':   3058 obs. of  16 variables:\n $ X               : int  1 2 3 4 5 6 7 8 9 10 ...\n $ site            : chr  \"AL\" \"AL\" \"AL\" \"AL\" ...\n $ year            : int  24 24 24 24 24 24 24 24 24 24 ...\n $ site.year       : chr  \"24AL\" \"24AL\" \"24AL\" \"24AL\" ...\n $ unique.id       : chr  \"24ALCC_ALT-01-01\" \"24ALCC_ALT-01-02\" \"24ALCC_ALT-01-03\" \"24ALCC_ALT-02-01\" ...\n $ entry           : chr  \"Aldo\" \"21NCCCLH\" \"23MDCC\" \"21NCCCE\" ...\n $ rep             : int  1 1 1 1 1 1 1 1 1 1 ...\n $ row             : int  1 2 3 1 2 3 1 2 3 1 ...\n $ range           : int  1 1 1 2 2 2 3 3 3 4 ...\n $ biomass.1       : num  56.3 46.4 55.8 79.8 60.4 ...\n $ growth.stage.1  : num  9 7 7 9 8 8 9 9 8 7 ...\n $ fallstandcount  : int  NA NA NA NA NA NA NA NA NA NA ...\n $ springstandcount: int  95 95 95 95 95 75 75 95 75 95 ...\n $ fall.vigor.av   : num  5 5 5 5 5 9 5 5 9 5 ...\n $ spring.vigor.av : num  9 5 5 9 5 5 5 5 5 5 ...\n $ wintersurvival  : num  NA NA NA NA NA NA NA NA NA NA ...\n\n\n\nalt %&gt;% head\n\n  X site year site.year        unique.id         entry rep row range biomass.1\n1 1   AL   24      24AL 24ALCC_ALT-01-01          Aldo   1   1     1  56.33333\n2 2   AL   24      24AL 24ALCC_ALT-01-02      21NCCCLH   1   2     1  46.41667\n3 3   AL   24      24AL 24ALCC_ALT-01-03        23MDCC   1   3     1  55.75000\n4 4   AL   24      24AL 24ALCC_ALT-02-01       21NCCCE   1   1     2  79.75000\n5 5   AL   24      24AL 24ALCC_ALT-02-02 23NCCCE Elite   1   2     2  60.41667\n6 6   AL   24      24AL 24ALCC_ALT-02-03         Dixie   1   3     2  57.16667\n  growth.stage.1 fallstandcount springstandcount fall.vigor.av spring.vigor.av\n1              9             NA               95             5               9\n2              7             NA               95             5               5\n3              7             NA               95             5               5\n4              9             NA               95             5               9\n5              8             NA               95             5               5\n6              8             NA               75             9               5\n  wintersurvival\n1             NA\n2             NA\n3             NA\n4             NA\n5             NA\n6             NA\n\n\nAbout\nThe CCBN ‚ÄúAdvanced Line Trial‚Äù (ALT) for Crimson Clover (Trifolium incarnatum) is a competitive variety trial. New ‚Äúadvanced line‚Äù bulks, created from top plants in CCBN nurseries, are compared against current best lines from other programs/years and commercial checks at up to 15 locations. Trials are conducted in randomized complete block designs with 15‚Äô single-row plots flanked by triticale for competition; they assess biomass, vigor, winter survival, seed yield.\n\n\n\n\n\n\nFigure¬†3: Map of Cover Crop Breeding Network Testing Sites\n\n\n\n\n\n\n\n\n\nFigure¬†4: Example of a CCB ALT Layout - 24ALCC_ALT\n\n\n\n\nsite: State Location Code\nyear: Year HARVESTED (trials are planted in Fall, harvested Spring of following year)\nsite.year: site-year combination\nunique.id: unique plot ID\nentry: Crimson Clover variety name.\nrep: integer - specifies a complete block within a given site.year\nrow: Corresponds to one full planter pass. I‚Äôd prefer these to be called columns to match matrix conventions (row ‚Äì by - column). But that‚Äôs how CCB records it (see Figure¬†4).\nrange: Spanning a plot in the direct the planter drives. In matrix convention, this would be called the row ü§¶ (see Figure¬†4).\nbiomass.1: plot dry mass in grams-per-linear-foot-harvested\ngrowth.stage.1: Khalu & Fick growth stage at time of harvest\nfall/springstandcount: percent of plot out of 100 with living plants, before/after winter.\nfall/spring.vigor.av: visual rating of plot vigor scored on a time-specific 1-9 scale (i.e.¬†1 = worst, 5 = average, 9 = best).\nwintersurvival: spring / fall standcount.",
    "crumbs": [
      "Module 1",
      "Linear Models with Matrices"
    ]
  },
  {
    "objectID": "lessons/2_LinearModels.html#your-task",
    "href": "lessons/2_LinearModels.html#your-task",
    "title": "Linear Models with Matrices",
    "section": "Your task",
    "text": "Your task\n\nFind a balanced chunk of the data.\nBalance is going to mean a lack of missing data for most or all traits.\nI suggest taking out 2-4 site.years worth.\nSubset the dataset.\nPick a trait and follow the steps we did above.\nStart simple with your modelling.\n\nQuestions:\n\nWhat are the potential sources of variation in the data? Write the model.\nWhat sources of variation are significant contributors to the model fit?\nWhich are the ‚Äúbest‚Äùperforming Crimson Clovers?",
    "crumbs": [
      "Module 1",
      "Linear Models with Matrices"
    ]
  },
  {
    "objectID": "lessons/2_LinearModels.html#subset-the-data",
    "href": "lessons/2_LinearModels.html#subset-the-data",
    "title": "Linear Models with Matrices",
    "section": "Subset the data",
    "text": "Subset the data\nThen I‚Äôll introduce a real dataset, give you a hint how to subset it, and turn you loose to analyze it yourself.\nSteps we‚Äôll do:\n\nPose a question\nWrite the model\nEstimate parameters with OLS\n\nSolve ‚Äúby hand‚Äù in R\nUsing the lm() function\n\nPartition variability: ANOVA\nHypothesis testing: F-test, t-test - is the effect and/or the variance ‚Äúsignificant‚Äù?",
    "crumbs": [
      "Module 1",
      "Linear Models with Matrices"
    ]
  },
  {
    "objectID": "lessons/2_LinearModels.html#data-summarization",
    "href": "lessons/2_LinearModels.html#data-summarization",
    "title": "Linear Models with Matrices",
    "section": "Data summarization",
    "text": "Data summarization\nTo find a good data chunk, you might want to make some summaries.\nHere‚Äôs a nice tidy way to computing summary statistics on a dataset like this, using group_by() and summarize()\n\n# Example\nalt %&gt;% \n  filter(site==\"AL\") %&gt;% \n  group_by(site.year) %&gt;% \n  summarize(PropMissingBiomass=length(which(is.na(biomass.1)))/n(),\n            Nentries=length(unique(entry)),\n            Nobs=n())\n\n# A tibble: 2 √ó 4\n  site.year PropMissingBiomass Nentries  Nobs\n  &lt;chr&gt;                  &lt;dbl&gt;    &lt;int&gt; &lt;int&gt;\n1 24AL                       0       28    56\n2 25AL                       0       30    60\n\n# Does the code for computing \"PropMissingBiomass\" look confusing? \n# To learn, break down each piece of the code and see what it does\n# Like this\n## alt$biomass.1 %&gt;% is.na\n## alt$biomass.1 %&gt;% is.na %&gt;% which\n## length(which(is.na(alt$biomass.1)))/nrow(alt)\n\nHaving chosen the 2 AL site-years (for an example), I can split off a new data.frame for future use.\n\nal_alt&lt;-alt %&gt;% \n  filter(site==\"AL\")",
    "crumbs": [
      "Module 1",
      "Linear Models with Matrices"
    ]
  },
  {
    "objectID": "lessons/2_LinearModels.html#plotting-data",
    "href": "lessons/2_LinearModels.html#plotting-data",
    "title": "Linear Models with Matrices",
    "section": "Plotting data",
    "text": "Plotting data\nI like to use ggplot for plotting in R.\nA great place to learn that is the Visualize chapter in R for Data Science.\nTo show it off, I‚Äôll make a histogram of the distribution of each trait in the dataset.\nA bit of data transformation is needed, using pivot_longer to make a long-form dataset.\n\nalt %&gt;% \n  pivot_longer(cols = c(biomass.1:wintersurvival),\n               names_to = \"Trait\",\n               values_to = \"Value\") %&gt;% \n  ggplot(.,aes(x=Value,fill=Trait)) + geom_density() + \n  facet_wrap(~Trait, scales='free')\n\nWarning: Removed 4531 rows containing non-finite outside the scale range\n(`stat_density()`).",
    "crumbs": [
      "Module 1",
      "Linear Models with Matrices"
    ]
  },
  {
    "objectID": "lessons/3_MixedModels.html",
    "href": "lessons/3_MixedModels.html",
    "title": "Intro to Mixed Models",
    "section": "",
    "text": "Previously: Reproducible Projects in R",
    "crumbs": [
      "Module 1",
      "Intro to Mixed Models"
    ]
  },
  {
    "objectID": "lessons/3_MixedModels.html#exploratory-data-analysis",
    "href": "lessons/3_MixedModels.html#exploratory-data-analysis",
    "title": "Linear Mixed Models",
    "section": "Exploratory data analysis",
    "text": "Exploratory data analysis\n\nLater, we‚Äôll take some time. Practice using R, especially dplyr and related tidyverse functions to summarize and get to know the dataset.\n\n\nTransforming data\npivot_wider() pivot_longer() group_by() + nest()\n\n\nAnalyzing multiple traits\npurrr()\nFunctions?\n\n\nSummary statistics\n\n\nTrait distributions"
  },
  {
    "objectID": "lessons/3_MixedModels.html#fixed-vs.-random",
    "href": "lessons/3_MixedModels.html#fixed-vs.-random",
    "title": "Intro to Mixed Models",
    "section": "Fixed vs.¬†Random",
    "text": "Fixed vs.¬†Random\nRecall that:\n\nFixed-effects: A fixed effect is a parameter that does not vary.\nRandom-effects: An effect whose value depends on ‚Äúrandom‚Äù events\n\nWhat is your objective?\n\nFixed - compare specific levels of factor\nRand - conclusions drawn from larger universe of interest\n\nWhat units are you sampling?\n\nFixed - investigator chosen treatment levels\nRand - random sampled levels\n\nStatistical purpose?¬†\n\nFixed - hypothesis tests on the mean - \\(H_0: \\tau_1 = \\tau_2 = \\tau_n\\)\nRand - tests on the variance components¬†- \\(H_0: \\sigma^2_{\\tau} = 0\\)\n\nComplex data model?\n\nRand - p&gt;&gt;n (more parameters, p than observations, n)\n(e.g.¬†genome-wide prediction)\n\n\n\nData contain hierarchically related and non-independent terms¬†\n\nGenotypes are related\nPlots within Trials within Years within Sites\nCorrelated residuals\n\nUneven replications / unbalanced data",
    "crumbs": [
      "Module 1",
      "Intro to Mixed Models"
    ]
  },
  {
    "objectID": "lessons/3_MixedModels.html#propose-a-mixed-model",
    "href": "lessons/3_MixedModels.html#propose-a-mixed-model",
    "title": "Intro to Mixed Models",
    "section": "Propose a mixed-model",
    "text": "Propose a mixed-model\n\\[y_{ij} = Y_i + R(Y)_{ij} + G_k + GY_{ik} + e_{ijk}\\]\n\n\\(\\mu\\) grand mean, intercept\n\\(Y_i\\) effect of year i\n\\(R(Y)_{ij} \\sim N(0,I\\sigma^2_r)\\) random-effect for blocks k nested within years i.\n\\(G_k \\sim N(0,I\\sigma^2_g)\\) effect of genotype (i.e.¬†entry, aka variety of crimson clover)\n\\(GY_{ik} \\sim N(0,I\\sigma^2_{g \\times y})\\) interaction effect, genotype-by-year\n\\(e_{ijk}\\) random error, distributed as \\(e_{ijk} \\sim N(0,I\\sigma^2_e)\\)\n\nNOTE that:\n\nRandom terms have an distribution with an associated mean and variance component\nInteractions even between fixed and random are random\n\nWe will call upon the lme4 package to fit our first mixed-models.\nlme4‚Äôs flagship function lmer() can fit mixed-models where the variance parameters are I.I.D. (independent and identically distributed).\nIn the next lesson, we‚Äôll learn asreml and/or sommer, which can handle more complex structures of the V matrix.\n\nlibrary(lme4)\n\n\nmm&lt;-lmer(biomass.1 ~site.year + (1|rep) + (1|entry) + (1|entry:site.year),\n         data = al_alt)\nsummary(mm)\n\nLinear mixed model fit by REML ['lmerMod']\nFormula: \nbiomass.1 ~ site.year + (1 | rep) + (1 | entry) + (1 | entry:site.year)\n   Data: al_alt\n\nREML criterion at convergence: 939.3\n\nScaled residuals: \n     Min       1Q   Median       3Q      Max \n-2.18776 -0.60236  0.00158  0.57017  2.76647 \n\nRandom effects:\n Groups          Name        Variance Std.Dev.\n entry:site.year (Intercept)  58.935   7.677  \n entry           (Intercept)  17.335   4.163  \n rep             (Intercept)   5.807   2.410  \n Residual                    142.962  11.957  \nNumber of obs: 116, groups:  entry:site.year, 58; entry, 35; rep, 4\n\nFixed effects:\n              Estimate Std. Error t value\n(Intercept)     50.027      2.858  17.506\nsite.year25AL  -11.592      3.878  -2.989\n\nCorrelation of Fixed Effects:\n            (Intr)\nsite.yr25AL -0.694\n\n\n\nplot(mm)\n\n\n\n\n\n\n\n\n\nhist(residuals(mm))\n\n\n\n\n\n\n\n\nI‚Äôd argue this looks a bit heteroskedastic. Might consider log-transform. Might not.\n\n# log_mm&lt;-lmer(logBiomass ~site.year + (1|rep) + (1|entry) + (1|entry:site.year),\n#          data = al_alt %&gt;% mutate(logBiomass=log(biomass.1)))\n# summary(log_mm)\n# plot(mm)\n# hist(residuals(mm))",
    "crumbs": [
      "Module 1",
      "Intro to Mixed Models"
    ]
  },
  {
    "objectID": "lessons/3_MixedModels.html#hypothesis-testing",
    "href": "lessons/3_MixedModels.html#hypothesis-testing",
    "title": "Intro to Mixed Models",
    "section": "Hypothesis testing",
    "text": "Hypothesis testing\n\nThis may not have come up in lecture.\nWe may want to test whether our variance estimates are different from zero, beyond a reasonable doubt. \\(H_0: \\sigma^2_g=0\\)\nFixed-effects models use\n\nF-tests (which are ratios of sums-of-squares) to determine the ‚Äúsignificance‚Äù of the sources of variation.\nt-tests are also used to compare coefficient estimates to zero.\n\nThe best way to do this for a mixed-model is a likelihood ratio test (LRT).\n\nLRTs compare focal models against so-called ‚Äúnull‚Äù models in which one or more variance component have been removed.\nAnother way to say this is that LRTs compare nested models.\nONLY nest-models. You cannot compare different datasets!\nThe ratio of likelihoods of the two models is compared to a \\(\\chi^2\\)-distribution.\nNOTE: Models differing in fixed-effects should be compared with maximum likelihood (not REML); i.e.¬†REML=FALSE in lmer().\n\n\\[\nLRT = -2 \\times ln\n\\left(\\dfrac{L(reduced)}{L(full)}\\right)\n\\]\nIf removing a particular variance component improves or does not change the fit of the model, that component is not of interest.\n\n\nmm_nullentry&lt;-lmer(biomass.1 ~site.year + (1|rep) + (1|entry:site.year),\n                   data = al_alt)\nanova(mm,mm_nullentry)\n\nrefitting model(s) with ML (instead of REML)\n\n\nData: al_alt\nModels:\nmm_nullentry: biomass.1 ~ site.year + (1 | rep) + (1 | entry:site.year)\nmm: biomass.1 ~ site.year + (1 | rep) + (1 | entry) + (1 | entry:site.year)\n             npar    AIC    BIC  logLik -2*log(L)  Chisq Df Pr(&gt;Chisq)\nmm_nullentry    5 957.01 970.78 -473.50    947.01                     \nmm              6 958.75 975.27 -473.37    946.75 0.2648  1     0.6069\n\n\n\nlibrary(lmerTest)\nrand(mm)\n\nANOVA-like table for random-effects: Single term deletions\n\nModel:\nbiomass.1 ~ site.year + (1 | rep) + (1 | entry) + (1 | entry:site.year)\n                      npar  logLik    AIC     LRT Df Pr(&gt;Chisq)  \n&lt;none&gt;                   6 -469.64 951.28                        \n(1 | rep)                5 -470.00 950.00 0.71145  1    0.39896  \n(1 | entry)              5 -469.77 949.54 0.25599  1    0.61289  \n(1 | entry:site.year)    5 -471.14 952.29 3.00386  1    0.08307 .\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1",
    "crumbs": [
      "Module 1",
      "Intro to Mixed Models"
    ]
  },
  {
    "objectID": "lessons/3_MixedModels.html#blup-vs.-blue",
    "href": "lessons/3_MixedModels.html#blup-vs.-blue",
    "title": "Intro to Mixed Models",
    "section": "BLUP vs.¬†BLUE",
    "text": "BLUP vs.¬†BLUE\n\nblups&lt;-ranef(mm)\nblups&lt;-blups$entry %&gt;% \n  rename(BLUP=`(Intercept)`) %&gt;% \n  rownames_to_column(var = \"entry\")\nblups_vs_means&lt;-adj_means %&gt;% left_join(blups)\n\nJoining with `by = join_by(entry)`\n\n\n\nblups_vs_means %&gt;% \n  ggplot(.,aes(x=mean,y=BLUP)) + geom_point() + \n  geom_hline(yintercept = 0,color='darkred') + \n  geom_abline(slope=1,color='darkred')\n\n\n\n\n\n\n\n\n\n# al_alt %&gt;% \n#   select(entry,biomass.1) %&gt;% \n#   left_join(blups) %&gt;% \n#   ggplot(.,aes(x=BLUP,y=biomass.1)) + geom_point() + \n#   labs(y=\"Raw Biomass Observations\",x=\"BLUPs\")",
    "crumbs": [
      "Module 1",
      "Intro to Mixed Models"
    ]
  },
  {
    "objectID": "lessons/4_MoreMixedModels.html",
    "href": "lessons/4_MoreMixedModels.html",
    "title": "More Complex Mixed Models",
    "section": "",
    "text": "Previously: Intro to Mixed Models",
    "crumbs": [
      "Module 1",
      "More Complex Mixed Models"
    ]
  },
  {
    "objectID": "lessons/4_MoreMixedModels.html#summarize-the-data",
    "href": "lessons/4_MoreMixedModels.html#summarize-the-data",
    "title": "Genetic Analysis with Mixed Models",
    "section": "Summarize the data",
    "text": "Summarize the data\n\nFind a balanced chunk of the data.\nBalance is going to mean a lack of missing data for most or all traits.\nI suggest taking out 2-4 site.years worth.\n\n\nalt %&gt;% \n  filter(site==\"AL\") %&gt;% \n  group_by(site.year) %&gt;% \n  summarize(PropMissingBiomass=length(which(is.na(biomass.1)))/n(),\n            Nentries=length(unique(entry)),\n            Nobs=n())\n\n\nalt$biomass.1 %&gt;% is.na\nalt$biomass.1 %&gt;% is.na %&gt;% which\nlength(which(is.na(alt$biomass.1)))/nrow(alt)",
    "crumbs": [
      "Module 1",
      "Genetic Analysis with Mixed Models"
    ]
  },
  {
    "objectID": "lessons/4_MoreMixedModels.html#install-asreml-r",
    "href": "lessons/4_MoreMixedModels.html#install-asreml-r",
    "title": "More Complex Mixed Models",
    "section": "Install asreml-R",
    "text": "Install asreml-R\nFirst thing, you‚Äôll need to install the asreml-R package. Please follow this written and video guide to download and install ASReml for R.\nhttps://asreml.kb.vsni.co.uk/knowledge-base/asreml-r-installation-guide/\nIt‚Äôs not as simple as install.packages(). You‚Äôll need the Activation Code I provided by email/Canvas. Note this is is a shared AU license including Horticulture, Forestry and CSES.",
    "crumbs": [
      "Module 1",
      "More Complex Mixed Models"
    ]
  },
  {
    "objectID": "lessons/4_MoreMixedModels.html#introduction",
    "href": "lessons/4_MoreMixedModels.html#introduction",
    "title": "More Complex Mixed Models",
    "section": "Introduction",
    "text": "Introduction\nPreviously, we introduced mixed-models and compared them to linear models.\nIn lecture, we dug into the mechanics (matrix equations, variance-covariance structures).\nThere are lot‚Äôs of software options for mixed-models. They vary in their accessibility, ease-of-use, functionality and computational efficiency. It‚Äôs beyond our scope here, but an Ch. 6 of Ahmadi and Bartholom√© (2022) gives a thorough overview as of 2022.\nHere‚Äôs a great Introduction to ASReml-R (Tanaka 2018).\nI highly recommend you reference the ASReml-R Reference Manual V4.2; it includes both code specifications AND theory. In my experience, to be successful, you‚Äôll need to use it.\nBE SURE YOU‚ÄôRE ON V4.2 (V3 had very different syntax).\n\n\n\nFrom Tanaka 2018 Slides\n\n\n\n\n\nEstimates of fixed effects and prediction of random effects (Tanaka 2018)\n\n\nThe lmer() function we learned previously only handles the case when \\(G\\) and \\(R\\) matrices are \\(I\\). In other words when errors and random-effects are independent and identically distributed (IID). We‚Äôll use asreml to access a richer universe of options.\n\n\n\nThe R user interface for ASReml (Tanaka 2018)",
    "crumbs": [
      "Module 1",
      "More Complex Mixed Models"
    ]
  },
  {
    "objectID": "lessons/4_MoreMixedModels.html#basics",
    "href": "lessons/4_MoreMixedModels.html#basics",
    "title": "More Complex Mixed Models",
    "section": "Basics",
    "text": "Basics\nThis section gives a quick primer on core asreml functionality. Examples with real data follow.\n\nASReml is a license-based propriety software.\nIt uses average information (AI)-REML to solve models.\nThe core software is based on FORTRAN and comes as a standalone program.\nASReml-R is an R-package that provides an interface to ASReml.\n\nIt is computationally pretty efficient thanks to using FORTRAN libraries under-the-hood rather than doing EVERYTHING in R.\nOne downside with using R: all datasets and matrices have to be held in your computers RAM. The smaller the RAM, the smaller the data you can handle.\n\n\n\nasreml(respone ~fixed_formula,\n       random = ~random_formula,\n       residual = ~rcov_formula)",
    "crumbs": [
      "Module 1",
      "More Complex Mixed Models"
    ]
  },
  {
    "objectID": "lessons/4_MoreMixedModels.html#variance-structures",
    "href": "lessons/4_MoreMixedModels.html#variance-structures",
    "title": "More Complex Mixed Models",
    "section": "Variance Structures",
    "text": "Variance Structures\nFor a complete list and specifications: Appendix C of the ASReml-R 4.2 Manual\n\nHomogeneous Variances\n\n# Example\nfit1 &lt;- asreml(Yield ~ Site,\n         random= ~ Site:Geno,\n         data=data1)\n\nBy default, asreml will assume random and residual terms are IID.\nIn the asreml manual, they call this the ‚Äúhomogeneous variance structure‚Äù.\nEquivalently, you can write:\n\nfit1a &lt;- asreml(Yield ~ Site, data=data1\n                random= ~ idv(Site):idv(Geno))\n\nThis stands for ‚Äúidentity variance‚Äù structure = \\(var(u_{site})=\\textbf{I}\\sigma^2_{Site}\\).\nSame goes for the residual term. Here‚Äôs another equivalence:\n\nfit1c &lt;- asreml(Yield ~ Site, data=data1,\n                random= ~ Site:Geno,\n                residual= ~ idv(units))\n\nNOTE: units is a special reserve word in asreml equivalent to factor(1:nrow(data1)). It only shows-up in residual terms.\n\n\nHeterogeneous Variances\nFor various reasons, we might want to estimate a separate error-variance for each of several trials.\nOr we might want to jointly analyze trials containing semi-overlapping populations / different numbers of genotypes. In such situations, you could postulate a different genetic variance for each site.\nFor this, we want ‚Äúheterogeneous variance‚Äù structures.\nIn asreml there are a few ways to do this:\nYou can use idh(Site):Geno or diag(Site):Geno.\nThese fit separate variances for each level of the factor indicated within the ().\n\n\nConditional factors with at()\nThe at(f,l) specifics a structure that conditions level l and factor f. It means, we can choose to estimate a variance term only at certain levels of an effect. For example, if a one trial is replicated and another is not, you might want to do a joint analysis of both trials, including the replication term only for the replicated trial. E.g. at(Site,\"PBU\"):rep.\nat() can be used in the G structure too. When the l (factor level) is not specified, e.g.¬†at(Site), instead of at(Site,\"PBU\") the result is equivalent to diag() or idh(), a separate variance is estimated for each Site.\nSee ASReml-R manual 3.7.",
    "crumbs": [
      "Module 1",
      "More Complex Mixed Models"
    ]
  },
  {
    "objectID": "lessons/4_MoreMixedModels.html#asreml-output",
    "href": "lessons/4_MoreMixedModels.html#asreml-output",
    "title": "More Complex Mixed Models",
    "section": "asreml Output",
    "text": "asreml Output\nBasic asreml output:\n\n# Variance Parameters\nsummary(fit1)$varcomp # or use lucid::vc(fit1)\n\n##  BLUPs / Prediction\n\n# E-BLUE\ncoef(fit1)$fixed\n\n# E-BLUP\ncoef(fit1)$random",
    "crumbs": [
      "Module 1",
      "More Complex Mixed Models"
    ]
  },
  {
    "objectID": "lessons/4_MoreMixedModels.html#lrts-and-model-comparison",
    "href": "lessons/4_MoreMixedModels.html#lrts-and-model-comparison",
    "title": "More Complex Mixed Models",
    "section": "LRTs and model comparison",
    "text": "LRTs and model comparison\nRecall the likelihood ratio test discussed previously:\n\\[\nLRT = -2 \\times ln\n\\left(\\dfrac{L(reduced)}{L(full)}\\right)\n\\]\nThis ratio is compared to a \\(\\chi^2\\)-distribution with degrees of freedom equal to the diff. in number of variance components between the two models.\nA small p-value for the test indicates the two models are different.\nIt DOES NOT necessarily mean your ‚Äúfull‚Äù model is the better model. Check the likelihood, or compare the AIC/BIC. If the full model has higher likelihood, then declare the focal variance component ‚Äúsignificant‚Äù.\nInformation Criterion\nAkaike Information Criterion (AIC), and the Bayesian Information Criterion (BIC) are related measures of the goodness-of-fit for a model.\n\\[AIC=-2 \\times logL + 2 \\times p\\]\n\\[BIC = -2 \\times logL + 2 \\times p \\times log(n)\\] - p is the number of varaince parameters in the model - n the number of observations\nWith AIC and BIC, lower-is-better, i.e.¬†the smaller AIC is the better model.\nBoth of these criteria prioritize models with a high likelihood while penalizing model complexity.\n\n# Fixed effects \n# Wald test\nfit &lt;- asreml(yield ~ Variety*Nitrogen, random= ~ Blocks/Wplots, data=oats)\n\nwald(fit)\n\n# Rand effects\nfull_model &lt;- asreml(yield ~ gen, random=~rep, trace=F,\n               data=burgueno.rowcol)\nnull_model &lt;- asreml(yield ~ gen, trace=F,\n               data=burgueno.rowcol)\nlrt(fit2, fit1)",
    "crumbs": [
      "Module 1",
      "More Complex Mixed Models"
    ]
  },
  {
    "objectID": "lessons/4_MoreMixedModels.html#other",
    "href": "lessons/4_MoreMixedModels.html#other",
    "title": "More Complex Mixed Models",
    "section": "Other",
    "text": "Other\nConvergence issues\n\nRun more iterations:\n\nincrease maxiter=\nUse update(fit)\nUse initial values (init) in the argument of the asreml function\n\n\nMemory space\n\nIncrease the RAM available to ASREML (workspace=\"10gb\")\nUse top, htop, Activity/System Monitor ‚Äì&gt; watch you system resources",
    "crumbs": [
      "Module 1",
      "More Complex Mixed Models"
    ]
  },
  {
    "objectID": "lessons/4_MoreMixedModels.html#example",
    "href": "lessons/4_MoreMixedModels.html#example",
    "title": "Genetic Analysis with Mixed Models",
    "section": "Example",
    "text": "Example\n\nData\n\nlibrary(tidyverse)\n\n\nalt&lt;-read.csv(here::here(\"data\",\"19-25CC_ALT_DATA_ALL_2025-08-23.csv\"))\n\n# My example data chunk, same as before\n# Keep using your own!\nal_alt&lt;-alt %&gt;% \n  filter(site==\"AL\")\n\n\n# Variance Parameters\nsummary(fit1)$varcomp # or use lucid::vc(fit1)\n\n\nsummary(asout,coef=T)$coef.random\n# E-BLUE\ncoef(fit1)$fixed\n\n# E-BLUP\ncoef(fit1)$random\n\n\n\nFitting models",
    "crumbs": [
      "Module 1",
      "Genetic Analysis with Mixed Models"
    ]
  },
  {
    "objectID": "lessons/4_MoreMixedModels.html#hands-on",
    "href": "lessons/4_MoreMixedModels.html#hands-on",
    "title": "Genetic Analysis with Mixed Models",
    "section": "Hands-on",
    "text": "Hands-on\n\nContinue with CCB ALT data\nFind the best-fit model for a data chunk that includes multiple site-years.",
    "crumbs": [
      "Module 1",
      "Genetic Analysis with Mixed Models"
    ]
  },
  {
    "objectID": "lessons/4_MoreMixedModels.html#multi-trial",
    "href": "lessons/4_MoreMixedModels.html#multi-trial",
    "title": "Genetic Analysis with Mixed Models",
    "section": "Multi-trial",
    "text": "Multi-trial",
    "crumbs": [
      "Module 1",
      "Genetic Analysis with Mixed Models"
    ]
  },
  {
    "objectID": "lessons/4_MoreMixedModels.html#gxe",
    "href": "lessons/4_MoreMixedModels.html#gxe",
    "title": "Genetic Analysis with Mixed Models",
    "section": "GxE",
    "text": "GxE",
    "crumbs": [
      "Module 1",
      "Genetic Analysis with Mixed Models"
    ]
  },
  {
    "objectID": "lessons/4_MoreMixedModels.html#two-stage",
    "href": "lessons/4_MoreMixedModels.html#two-stage",
    "title": "Genetic Analysis with Mixed Models",
    "section": "Two-stage",
    "text": "Two-stage",
    "crumbs": [
      "Module 1",
      "Genetic Analysis with Mixed Models"
    ]
  },
  {
    "objectID": "lessons/4_MoreMixedModels.html#separable-structures",
    "href": "lessons/4_MoreMixedModels.html#separable-structures",
    "title": "More Complex Mixed Models",
    "section": "Separable structures",
    "text": "Separable structures\nSeparability means that a covariance structure can be broekn down into the product of smaller matrices (non-technical definition, see ASReml-R manual 2.1.9).\n\\[\n\\Sigma_{u_{AB}} = var(u_{AB}) = \\Sigma_A \\otimes \\Sigma_B\n\\]\n\\(\\otimes\\) is called a ‚ÄúKronecker‚Äù product in matrix algebra.\n\n\n\nIllustration of a Kronecker Product from 10.48550/arXiv.2305.03875\n\n\n\n\nIt means that one variance structure can be ‚Äúcrossed‚Äù or ‚Äúinteracted‚Äù with another.\nHere‚Äôs an example:\n\nfit2 &lt;- asreml(Yield ~ Site, \n              random=~ us(Site):id(Geno),\n              data=data1)\n\nThe us(Site) stands for ‚Äúunstructured‚Äù covariance. It means a difference variance and a different covariance are estimated for every level.\nThis one is useful for multi-trait models, among other things. WARNING: Convergence failures and matrix-inversion failures common as us() estimates all pairwise variance components. More terms to estimate = fewer degrees of freedom = higher amount of data needed.\n\nbecomes",
    "crumbs": [
      "Module 1",
      "More Complex Mixed Models"
    ]
  },
  {
    "objectID": "lessons/4_MoreMixedModels.html#residual-structures",
    "href": "lessons/4_MoreMixedModels.html#residual-structures",
    "title": "More Complex Mixed Models",
    "section": "Residual structures",
    "text": "Residual structures\nIn a multi-environment and multi-year trial, it is realistic to expect different amounts of experimental error across trials.\n\nThis situation can be handled using dsum(), which allows for Conditional Factors in the residual. Note that, in some cases, at() can be used equivalently in the residual.\ndsum() ‚Äúa direct sum of l variance matrices, one for each level of the conditioning factor‚Ä¶ The data observations are partitioned into‚Ä¶ sections to which separate variance structures are applied.‚Äù (see ASReml-R manual 3.7)\n\n# generic\nresidual = ~dsum(~units | section)\n# example\nfit3 &lt;- asreml(Yield ~ Site, \n              random=~ us(Site):id(Geno),\n              residual = ~dsum(~units|Site),\n              data=data1)\n\ndsum() can also specify different structures on the residuals within different sections (e.g.¬†different Sites.\nRULES for Residual Term:\n\nNumber of effects in residual must be equal to number of observations.\nCompound terms in residual need to ensure each combo of levels uniquely identifies one unit of data.\nThe data must be ordered to match the residual. E.g. sort observations within Sites for ~dsum(units | Site).",
    "crumbs": [
      "Module 1",
      "More Complex Mixed Models"
    ]
  },
  {
    "objectID": "lessons/4_MoreMixedModels.html#data",
    "href": "lessons/4_MoreMixedModels.html#data",
    "title": "More Complex Mixed Models",
    "section": "Data",
    "text": "Data\n\nlibrary(tidyverse)\nlibrary(asreml)\n\nOnline License checked out Wed Jan 28 11:01:48 2026\n\nlibrary(lme4)\n\n\nalt&lt;-read.csv(here::here(\"data\",\"19-25CC_ALT_DATA_ALL_2025-08-23.csv\"))\n\n# My example data chunk, same as before\n# Keep using your own!\nal_alt&lt;-alt %&gt;% \n  filter(site==\"AL\")\n\n# Make factors before modeling\nal_alt&lt;-al_alt %&gt;% \n  mutate(entry=as.factor(entry),\n         site.year=as.factor(site.year),\n         # explicitly nest values of rep in site.year\n         # review explicit vs. implicit nesting\n         rep=as.factor(paste0(site.year,\"-\",rep)))",
    "crumbs": [
      "Module 1",
      "More Complex Mixed Models"
    ]
  },
  {
    "objectID": "lessons/4_MoreMixedModels.html#lmer-vs.-asreml",
    "href": "lessons/4_MoreMixedModels.html#lmer-vs.-asreml",
    "title": "More Complex Mixed Models",
    "section": "lmer vs.¬†asreml",
    "text": "lmer vs.¬†asreml\nThe lmer model we fit was:\n\nlmer_mm&lt;-lmer(biomass.1 ~site.year + (1|rep) + (1|entry) + (1|entry:site.year),\n         data = al_alt)\nsummary(lmer_mm)\n\nLinear mixed model fit by REML ['lmerMod']\nFormula: \nbiomass.1 ~ site.year + (1 | rep) + (1 | entry) + (1 | entry:site.year)\n   Data: al_alt\n\nREML criterion at convergence: 939.3\n\nScaled residuals: \n     Min       1Q   Median       3Q      Max \n-2.18776 -0.60236  0.00158  0.57017  2.76647 \n\nRandom effects:\n Groups          Name        Variance Std.Dev.\n entry:site.year (Intercept)  58.935   7.677  \n entry           (Intercept)  17.335   4.163  \n rep             (Intercept)   5.807   2.410  \n Residual                    142.962  11.957  \nNumber of obs: 116, groups:  entry:site.year, 58; entry, 35; rep, 4\n\nFixed effects:\n              Estimate Std. Error t value\n(Intercept)     50.027      2.858  17.506\nsite.year25AL  -11.592      3.878  -2.989\n\nCorrelation of Fixed Effects:\n            (Intr)\nsite.yr25AL -0.694\n\n\nWe can fit the equivalent model with asreml like so:\n\nasr_mm&lt;-asreml(biomass.1 ~site.year,\n               random = ~entry + rep + site.year:entry,\n               data = al_alt)\n\nASReml Version 4.2 28/01/2026 11:01:49\n          LogLik        Sigma2     DF     wall\n 1     -366.2039      175.6047    114   11:01:49\n 2     -365.4699      164.5684    114   11:01:49\n 3     -364.8944      145.4173    114   11:01:49\n 4     -364.8831      143.0244    114   11:01:49\n 5     -364.8830      142.9635    114   11:01:49\n\nsummary(asr_mm)$varcomp\n\n                 component std.error   z.ratio bound %ch\nrep               5.806474  10.86064 0.5346348     P 0.1\nentry            17.335959  32.80183 0.5285059     P 0.1\nsite.year:entry  58.934355  40.82486 1.4435898     P 0.0\nunits!R         142.963533  27.02516 5.2900159     P 0.0\n\n# lucid::vc(asr_mm) ## this just makes a prettier looking output\n\n\n# E-BLUE\ncoef(asr_mm)$fixed\n\n                  effect\n(Intercept)     50.02667\nsite.year_24AL   0.00000\nsite.year_25AL -11.59152\n\n\n\n# E-BLUP for entry\ncoef(asr_mm,list = T)$entry %&gt;% head\n\n                       effect\nentry_17MDCCH       1.0255866\nentry_17MDCCS       2.5387950\nentry_17RMCCL      -1.8767066\nentry_18NCCCEGiant  1.3787976\nentry_19MDCC        1.8343968\nentry_19NCCCLH     -0.3611015\n\n\nThis gives us just the BLUPs.\n\n# Also E-BLUP\nsummary(asr_mm,coef=T)$coef.random %&gt;% head\n\n                     solution std.error     z.ratio\nentry_17MDCCH       1.0255866  3.718116  0.27583502\nentry_17MDCCS       2.5387950  3.718116  0.68281758\nentry_17RMCCL      -1.8767066  3.922077 -0.47849816\nentry_18NCCCEGiant  1.3787976  3.921467  0.35160252\nentry_19MDCC        1.8343968  3.718116  0.49336729\nentry_19NCCCLH     -0.3611015  3.718116 -0.09711949\n\n\nThis gives us also the standard errors, which when squared give us the Prediction Error Variances (PEVs).",
    "crumbs": [
      "Module 1",
      "More Complex Mixed Models"
    ]
  },
  {
    "objectID": "lessons/4_MoreMixedModels.html#check-assumptions",
    "href": "lessons/4_MoreMixedModels.html#check-assumptions",
    "title": "More Complex Mixed Models",
    "section": "Check assumptions",
    "text": "Check assumptions\nWe can plot residuals and check assumptions in much the same was as with plot.lmer.\n\nplot(asr_mm)\n\nWarning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.\n‚Ñπ Please use `linewidth` instead.\n‚Ñπ The deprecated feature was likely used in the asreml package.\n  Please report the issue to the authors.",
    "crumbs": [
      "Module 1",
      "More Complex Mixed Models"
    ]
  },
  {
    "objectID": "lessons/4_MoreMixedModels.html#hypothesis-testing-with-asreml",
    "href": "lessons/4_MoreMixedModels.html#hypothesis-testing-with-asreml",
    "title": "More Complex Mixed Models",
    "section": "Hypothesis testing with asreml",
    "text": "Hypothesis testing with asreml\nNow let‚Äôs do a likelihood ratio test.\n\nasr_nullentry&lt;-asreml(biomass.1 ~site.year,\n                      random = ~rep + site.year:entry,\n                      data = al_alt)\n\nASReml Version 4.2 28/01/2026 11:01:49\n          LogLik        Sigma2     DF     wall\n 1     -367.3448      192.4790    114   11:01:49\n 2     -366.0755      174.8798    114   11:01:49\n 3     -365.2521      156.9297    114   11:01:49\n 4     -365.0124      143.9875    114   11:01:49\n 5     -365.0110      142.9698    114   11:01:49\n\nlrt(asr_mm,asr_nullentry)\n\nLikelihood ratio test(s) assuming nested random models.\n(See Self & Liang, 1987)\n\n                     df LR-statistic Pr(Chisq)\nasr_mm/asr_nullentry  1      0.25599    0.3064\n\n\nThat‚Äôs a bummer. The genetic effect in the data chunk does not appear significant.\nTest on the fixed effects\n\nwald(asr_mm)\n\n\u001b[0;34mWald tests for fixed effects.\u001b[0m\n\u001b[0;34mResponse: biomass.1\u001b[0m\n\u001b[0;34mTerms added sequentially; adjusted for those above.\u001b[0m\n\n              Df Sum of Sq Wald statistic Pr(Chisq)    \n(Intercept)    1     65703         459.58 &lt; 2.2e-16 ***\nsite.year      1      1278           8.94  0.002792 ** \nresidual (MS)          143                             \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n\nNOTE: if you really want to do sig. tests on your mixed-model‚Äôs fixed effects, do some reading first. There are some options we should consider regarding the Wald test. Namely, I believe it does an equivalent of a Type I SS (sequential). I think (am not certain) you can achieve something like a Type III (non-sequential) with something like this wald(fit, ssType=\"conditional\", denDF=\"numeric\"). Verify.",
    "crumbs": [
      "Module 1",
      "More Complex Mixed Models"
    ]
  },
  {
    "objectID": "lessons/4_MoreMixedModels.html#variance-structures-1",
    "href": "lessons/4_MoreMixedModels.html#variance-structures-1",
    "title": "More Complex Mixed Models",
    "section": "Variance structures",
    "text": "Variance structures\nNext, let‚Äôs fit a more appropriate data to the model, one that lmer cannot do.\nThere are several possibilities: 1. Fit a heterogeneous (different) error variance for each site.year 2. There are a few entry in 24AL that are not in 25AL, one could estimate a different genetic variance for each site.year. 3. Variance among complete blocks could differ between site.years.\nFor demo purposes, I‚Äôll focus on the heterogeneous errors. That‚Äôs what‚Äôs most plausible IMHO.\n\nasr_heterror&lt;-asreml(biomass.1 ~site.year,\n                     random = ~entry + rep + site.year:entry,\n                     residual = ~dsum(~units|site.year),\n                     data = al_alt %&gt;% arrange(site.year,X))\n\nASReml Version 4.2 28/01/2026 11:01:49\n          LogLik        Sigma2     DF     wall\n 1     -371.5225           1.0    114   11:01:49\n 2     -367.8455           1.0    114   11:01:49\n 3     -364.3065           1.0    114   11:01:49\n 4     -362.4049           1.0    114   11:01:49\n 5     -362.2450           1.0    114   11:01:49\n 6     -362.2319           1.0    114   11:01:49\n 7     -362.2270           1.0    114   11:01:49\n 8     -362.2242           1.0    114   11:01:49\n 9     -362.2221           1.0    114   11:01:49\n10     -362.2202           1.0    114   11:01:49  (  1 restrained)\n11     -362.2197           1.0    114   11:01:49  (  1 restrained)\n12     -362.2197           1.0    114   11:01:49  (  1 restrained)\n\n\n\n# summary(asr_heterror)$varcomp\nlucid::vc(asr_heterror)\n\n           effect component std.error z.ratio bound %ch\n              rep   0.00001        NA      NA     B  NA\n            entry  20.7         37.16    0.56     P   0\n  site.year:entry  74.16        43.06    1.7      P   0\n site.year_24AL!R 196           47.75    4.1      P   0\n site.year_25AL!R  80.66        21.29    3.8      P   0\n\n\nNotice that two separate error variance estimates are produced, one for each site.year.\nLooks like 25AL had smaller error than 24AL.\nNow we have a nested model between the original and the one with added het. errors.\nTwo ways to compare:\n\nlrt(asr_mm,asr_heterror)\n\nLikelihood ratio test(s) assuming nested random models.\n(See Self & Liang, 1987)\n\n                    df LR-statistic Pr(Chisq)  \nasr_heterror/asr_mm  1       5.3265    0.0105 *\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n\nOk, so the LRT says these two models are different.\n\nplot(asr_heterror)\n\nWith complex residual structures, it appears asreml won‚Äôt auto-plot your residual diagnostics.\nDistribution of residuals\n\nhist(residuals(asr_heterror))\n\n\n\n\n\n\n\n\nStandardized residuals vs.¬†fitted.\n\nplot(x=fitted(asr_heterror),y=scale(residuals(asr_heterror))); abline(b = 0,h = 0)\n\n\n\n\n\n\n\n\nQQ plot:\n\nres&lt;-residuals(asr_heterror)\nqqnorm(res); qqline(res, col = \"red\")",
    "crumbs": [
      "Module 1",
      "More Complex Mixed Models"
    ]
  },
  {
    "objectID": "lessons/4_MoreMixedModels.html#model-comparison",
    "href": "lessons/4_MoreMixedModels.html#model-comparison",
    "title": "More Complex Mixed Models",
    "section": "Model comparison",
    "text": "Model comparison\nAIC and BIC are computed by asreml and available in the summary object. As long as you‚Äôve got the same data and fixed-effects, you can use this along with the LRT to determine which model is best fit.\n\nsummary(asr_mm)$aic\n\n[1] 737.766\nattr(,\"parameters\")\n[1] 4\n\n\n\nsummary(asr_heterror)$aic\n\n[1] 734.4394\nattr(,\"parameters\")\n[1] 5\n\n\nSo the heterror model does have a lower AIC value. Along with the LRT p-value, we can declare this a significantly better model.\n\nasr_heterror_nullg&lt;-asreml(biomass.1 ~site.year,\n                           random = ~rep + site.year:entry,\n                           residual = ~dsum(~units|site.year),\n                           data = al_alt %&gt;% arrange(site.year,X), \n                           maxit=90)\n\nASReml Version 4.2 28/01/2026 11:01:50\n          LogLik        Sigma2     DF     wall\n 1     -376.5979           1.0    114   11:01:50\n 2     -371.1740           1.0    114   11:01:50\n 3     -365.8315           1.0    114   11:01:50\n 4     -363.1212           1.0    114   11:01:50\n 5     -362.4069           1.0    114   11:01:50\n 6     -362.3648           1.0    114   11:01:50\n 7     -362.3575           1.0    114   11:01:50\n 8     -362.3539           1.0    114   11:01:50\n 9     -362.3515           1.0    114   11:01:50\n10     -362.3495           1.0    114   11:01:50  (  1 restrained)\n11     -362.3482           1.0    114   11:01:50  (  1 restrained)\n12     -362.3481           1.0    114   11:01:50  (  1 restrained)\n13     -362.3481           1.0    114   11:01:50  (  1 restrained)\n\n\n\nlrt(asr_heterror_nullg,asr_heterror)\n\nLikelihood ratio test(s) assuming nested random models.\n(See Self & Liang, 1987)\n\n                                df LR-statistic Pr(Chisq)\nasr_heterror/asr_heterror_nullg  1       0.2568    0.3062\n\n\nYeah, well, still not showing significant genetic variation. Bummer.\n\nsummary(asr_heterror)$aic - summary(asr_heterror_nullg)$aic\n\n[1] 1.743201\nattr(,\"parameters\")\n[1] 5\n\n\nThe AIC of the full model is higher than the null.\nWhat about the GxE term?\n\nasr_heterror_nullgxe&lt;-asreml(biomass.1 ~site.year,\n                           random = ~entry + rep,\n                           residual = ~dsum(~units|site.year),\n                           data = al_alt %&gt;% arrange(site.year,X), \n                           maxit=90)\n\nASReml Version 4.2 28/01/2026 11:01:50\n          LogLik        Sigma2     DF     wall\n 1     -376.8922           1.0    114   11:01:50\n 2     -372.0801           1.0    114   11:01:50\n 3     -367.5884           1.0    114   11:01:50\n 4     -365.4995           1.0    114   11:01:50\n 5     -364.8730           1.0    114   11:01:50\n 6     -364.7547           1.0    114   11:01:50  (  1 restrained)\n 7     -364.7217           1.0    114   11:01:50  (  1 restrained)\n 8     -364.7161           1.0    114   11:01:50  (  1 restrained)\n 9     -364.7154           1.0    114   11:01:50  (  1 restrained)\n\nlrt(asr_heterror_nullgxe,asr_heterror)\n\nLikelihood ratio test(s) assuming nested random models.\n(See Self & Liang, 1987)\n\n                                  df LR-statistic Pr(Chisq)  \nasr_heterror/asr_heterror_nullgxe  1       4.9914   0.01274 *\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nsummary(asr_heterror)$aic - summary(asr_heterror_nullgxe)$aic\n\n[1] -2.991408\nattr(,\"parameters\")\n[1] 5\n\n\nOk! So the GxSiteYear term is significant and improves model fit.\nThere‚Äôs more that can be done here, alternative models that could be tested.\nGood enough for our demo.",
    "crumbs": [
      "Module 1",
      "More Complex Mixed Models"
    ]
  },
  {
    "objectID": "lessons/4_MoreMixedModels.html#pev-and-rel",
    "href": "lessons/4_MoreMixedModels.html#pev-and-rel",
    "title": "More Complex Mixed Models",
    "section": "PEV and REL",
    "text": "PEV and REL\nLet‚Äôs say we are happy with our model.\nNow we want to extract BLUPs, and compute the Reliability of Prediction.\nThe summary() function includes the ‚Äústandard errors‚Äù of prediction.\n\nblups&lt;-summary(asr_heterror,coef=T)$coef.random %&gt;% \n  # confert to data.frame\n  as.data.frame %&gt;% \n  # change the rownames to a column the the data.frame\n  rownames_to_column(var = \"entry\") %&gt;% \n  # filter to only the BLUPs for the entry main-effect \n  # (output includes all random terms)\n  filter(grepl(\"^entry_\",entry)) %&gt;% \n  # for good measure, tidy data, \n  # need to remove a prefix that asreml added to each entry name\n  mutate(entry=gsub(\"entry_\",\"\",entry,fixed = T))\nblups %&gt;% dim\n\n[1] 35  4\n\n\n\nblups %&gt;% head\n\n         entry   solution std.error    z.ratio\n1      17MDCCH  1.5784997  4.008503  0.3937878\n2      17MDCCS  2.7495080  4.008503  0.6859189\n3      17RMCCL -1.7051249  4.307455 -0.3958544\n4 18NCCCEGiant  1.7966818  4.199167  0.4278663\n5       19MDCC  2.1806776  4.008503  0.5440129\n6     19NCCCLH -0.5985299  4.008503 -0.1493151\n\n\nRecall that \\[REL_i = 1 - \\frac{PEV_i}{\\sigma^2_u}\\]\n\nVg&lt;-summary(asr_heterror)$varcomp[\"entry\",\"component\"]\nblups&lt;-blups %&gt;% \n  mutate(PEV=std.error^2,\n         REL=1-(PEV/Vg))\n\nhist(blups$REL)\n\n\n\n\n\n\n\n\nRecall that the average reliability of prediction for a main genetic effect is an estimator of the heritability (ratio of genetic to total phenotypic variance) (Cullis, Smith, and Coombes (2006); Schmidt et al. (2019)) .\n\nmean(blups$REL)\n\n[1] 0.1914108",
    "crumbs": [
      "Module 1",
      "More Complex Mixed Models"
    ]
  },
  {
    "objectID": "lessons/4_MoreMixedModels.html#heritability",
    "href": "lessons/4_MoreMixedModels.html#heritability",
    "title": "More Complex Mixed Models",
    "section": "Heritability",
    "text": "Heritability\nWe haven‚Äôt talked much about Quantitative Genetics parameters yet.\nThe heritability is a critical parameter in genetics. It expresses that fraction of trait variation that is genetic. It is used, among other things, to predict the response of a population to selection. See ‚ÄúBreeder‚Äôs Equation‚Äù; we‚Äôll talk about it soon!\nLet‚Äôs compare the Cullis estimate (~0.19) to the ‚Äútraditional‚Äù variance component based one.\nThe formula should be something like this:\n\\[\nH^2 = \\frac{\\sigma^2_g}{\\sigma^2_g + \\sigma^2_{g\\times yr} + \\frac{\\bar{\\sigma^2_{e_k}}}{nYrs}}\n\\]\nNote I took the mean error across site.years.\n\nvarcomps&lt;-summary(asr_heterror)$varcomp\nVgXsiteyr&lt;-varcomps[\"site.year:entry\",\"component\"]\nVe_meanPerSite&lt;-mean(varcomps[grepl(\"site.year_\",rownames(varcomps)),\"component\"])\n\nVg / (Vg + VgXsiteyr + Ve_meanPerSite)\n\n[1] 0.08875425",
    "crumbs": [
      "Module 1",
      "More Complex Mixed Models"
    ]
  },
  {
    "objectID": "lessons/5_DataWrangling.html",
    "href": "lessons/5_DataWrangling.html",
    "title": "Data Wrangling and Exploratory Data Analysis",
    "section": "",
<<<<<<< HEAD
    "text": "Previously: More Complex Mixed Models"
=======
    "text": "Previously: Intro to Mixed Models"
>>>>>>> e3d92ed15b1fe685ce2c792edeaf08bf0b9b814f
  },
  {
    "objectID": "lessons/5_DataWrangling.html#summarize-the-data",
    "href": "lessons/5_DataWrangling.html#summarize-the-data",
    "title": "Data Wrangling and Exploratory Data Analysis",
    "section": "Summarize the data",
    "text": "Summarize the data\n\nFind a balanced chunk of the data.\nBalance is going to mean a lack of missing data for most or all traits.\nI suggest taking out 2-4 site.years worth.\n\n\nalt %&gt;% \n  filter(site==\"AL\") %&gt;% \n  group_by(site.year) %&gt;% \n  summarize(PropMissingBiomass=length(which(is.na(biomass.1)))/n(),\n            Nentries=length(unique(entry)),\n            Nobs=n())\n\n\nalt$biomass.1 %&gt;% is.na\nalt$biomass.1 %&gt;% is.na %&gt;% which\nlength(which(is.na(alt$biomass.1)))/nrow(alt)"
  },
  {
    "objectID": "lessons/5_DataWrangling.html#multi-trial",
    "href": "lessons/5_DataWrangling.html#multi-trial",
    "title": "Data Wrangling and Exploratory Data Analysis",
    "section": "Multi-trial",
    "text": "Multi-trial"
  },
  {
    "objectID": "lessons/5_DataWrangling.html#gxe",
    "href": "lessons/5_DataWrangling.html#gxe",
    "title": "Data Wrangling and Exploratory Data Analysis",
    "section": "GxE",
    "text": "GxE"
  },
  {
    "objectID": "lessons/5_DataWrangling.html#two-stage",
    "href": "lessons/5_DataWrangling.html#two-stage",
    "title": "Data Wrangling and Exploratory Data Analysis",
    "section": "Two-stage",
    "text": "Two-stage"
  }
]